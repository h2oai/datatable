version: 0.10.{build}
image: Visual Studio 2019

branches:
  only:
    - master

pull_requests:
  do_not_increment_build_number: true

artifacts:
  - path: dist\*.whl

build_script:
- cmd: >-

    FOR /f %%i in ('git rev-list --count master') DO SET REV_COUNT_MASTER=%%i



    if "%APPVEYOR_PULL_REQUEST_HEAD_REPO_BRANCH:~0,4%"=="rel-" (SET DT_RELEASE=True)

    else if "%APPVEYOR_REPO_BRANCH%"=="master" (SET DT_BUILD_NUMBER=%REV_COUNT_MASTER%)

    else (SET DT_BUILD_SUFFIX=%APPVEYOR_PULL_REQUEST_HEAD_REPO_BRANCH%.%REV_COUNT_MASTER%)



    SET PATH=C:\Python35-x64;C:\Python35-x64\Scripts;%PATH%

    python ci\ext.py wheel

    FOR %%i in (dist\*-cp35-*.whl) DO pip install %%i

    pip install pytest docutils pandas

    pytest .\tests\



    SET PATH=C:\Python36-x64;C:\Python36-x64\Scripts;%PATH%

    python ci\ext.py wheel

    FOR %%i in (dist\*-cp36-*.whl) DO pip install %%i

    pip install pytest docutils pandas

    pytest .\tests\



    SET PATH=C:\Python37-x64;C:\Python37-x64\Scripts;%PATH%

    python ci\ext.py wheel

    FOR %%i in (dist\*-cp37-*.whl) DO pip install %%i

    pip install pytest docutils pandas

    pytest .\tests\



    SET PATH=C:\Python38-x64;C:\Python38-x64\Scripts;%PATH%

    python ci\ext.py wheel

    FOR %%i in (dist\*-cp38-*.whl) DO pip install %%i

    pip install pytest docutils pandas

    pytest .\tests\


